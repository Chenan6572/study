define(function(require) {
	var $ = require("jquery");
	var justep = require("$UI/system/lib/justep");
	var base = require("$UI/system/api/native/base");
	require("$UI/system/lib/cordova/cordova");
	require("cordova!cordova-plugin-camera");
	require("cordova!cordova-plugin-file");
	require("cordova!cordova-open");
	require("cordova!cordova-plugin-file-transfer");
	require("css!$UI/zupu/css/layui").load();
	require("$UI/zupu/js/layui");
	require("$UI/zupu/js/modules/element");
	layui.use('element', function() {
		var element = layui.element;
		console.log(element);
		
	});
	var Model = function() {
		this.callParent();
		this.wx = base.getWx();
	};

	Model.prototype.btnNewMatterClick = function(event) {
		justep.Shell.showPage("matterapply");
	};

	Model.prototype.downLoadFile = function(event) {
		// var divProgress =
		// $(event.source.domNode.parentElement.parentElement).find("div[xid='progressbar1']");
		// //获取当前行的进度条XID
		// var downLoadBtn =
		// $(event.source.domNode.parentElement).find("a[xid='button1']")
		// var row = event.bindingContext.$object; //获取当前行的数据
		var filePath = 'file:///storage/emulated/0/biyao/申请书.doc'; // 下载路径,数据库保存文件名
		// var uri = encodeURI(row.val('fUrl')); //下载地址
		var uri = "http://39.107.254.59:8080/zupu/v-1.0.1-zh_CN-/zupu/upload/staff1.doc";// encodeURI(row.val('fUrl'));
																							// //下载地址

		var fileTransfer = new FileTransfer();
		fileTransfer.onprogress = function(progressEvent) { // 文件传输插件对象的进度方法调用
			var percentProgress = parseInt((progressEvent.loaded / progressEvent.total) * 100)
					+ "%"; // 获取已下载和总大小的百分比
			if (progressEvent.lengthComputable)// 获取浏览器返回HEAD信息包含CONTENT-LENGTH为TRUE
												// 则执行下面
			{
				console.log(percentProgress);
				// divProgress.css("width",percentProgress); //设置进度条的样式
				// divProgress.html(percentProgress); //设置进度条里面的数字
			}
		};

		fileTransfer.download( // 调用对象的下载方法，开始下载
		uri, filePath, function(entry) {
			console.log("download complete: " + entry.fullPath);// 下载完成后调用方法
			// 这里下载完成后，将进度条隐藏或者写其他需要的代码
			justep.Util.hint('下载成功！');
			downLoadBtn.hide();
		}, function(error) { // 出错回调函数
			console.log("download error source " + error.source);
			console.log("download error target " + error.target);
			console.log("upload error code" + error.code);
		}, false, {
			headers : {
				"Authorization" : "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
			}
		});
	};

	Model.prototype.openFile = function(event) {
		if (this.wx) {
			warning.onAlert();
		} else {
			var open = cordova.plugins.disusered.open;
			console.log("");
			function success() {
				justep.Util.hint('Success');
			}
			function error(code) {
				if (code === 1) {
					justep.Util.hint('No file handler found');
				} else {
					justep.Util.hint('Undefined error');
				}
			}

			var filePath = 'file:///storage/emulated/0/biyao/申请书.doc';
			open(filePath, success, error);
		}

	};

	return Model;
});