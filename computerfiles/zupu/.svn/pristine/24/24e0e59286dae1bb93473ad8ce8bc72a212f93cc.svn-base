define(function(require) {
	var $ = require("jquery");
	var justep = require("$UI/system/lib/justep");
	var jsonsql = require("$UI/zupu/lib/jsonsql");

	var Model = function() {
		this.callParent();
	};
	// 验证手机号
	function isPhoneNo(phone) {
		var pattern = /^1[34578]\d{9}$/;
		return pattern.test(phone);
	}
	//用户id
	var user =localStorage.getItem("perid");
	console.log("用户id"+user);
	// 发送短信验证码
	var phonenum ;

	Model.prototype.yzm = function(event) {
		phonenum = $("#phonenum").val()
		console.log("电话" + phonenum);
		// 测试电话
		
		console.log("点击获取手机验证码");
		if (!isPhoneNo(phonenum)) {
			justep.Util.hint("手机号格式错误！", {
				type : 'danger'
			});
			console.log("我在测试手机号");
		} else {
			// 向后台传送手机号
			$.ajax({
				
				url : 'http://10.10.1.232:8088/YProject/yanz/getCode?login_name=' + phonenum,
				processData : false,
				cache : false,
				async : true,
				global : false,
				contentType : "application/json; charset=utf-8",
				datatype : "json",
				type : 'get',
				success : function(res) {
					justep.Util.hint("验证码发送成功，请填写验证码！", {
						type : 'string'

					});
					console.log("验证码" + res.data);
				},
				error : function(res) {
					justep.Util.hint("验证码发送失败，请稍后再试！", {
						type : 'danger'
					});
				}
			});
			return;
		}
	};
	// 点击提交
	Model.prototype.subclick = function(event) {
		var phonenum = $("#phonenum").val();
		console.log("填写的手机号" + phonenum);
		//验证码
		var verification = $("#verification").val();
		console.log( "验证码"+verification);
		if (!isPhoneNo(phonenum)) {
			justep.Util.hint("请填写正确的手机号！", {
				type : 'danger'
			});
		} else {
			$.ajax({
				headers:{
					Authorization: "Bearer " + localStorage.getItem('Token'),
				},
				url : 'http://10.10.1.232:8088/YProject/api/bind_phone?id=' + user + '&bind_phone=' + phonenum + '&code=' + verification,
				cache : false,
				async : false,
				global : false,
				contentType : "application/json; charset=utf-8",
				datatype : "json",
				type : 'get',
				success : function(res) {
					justep.Util.hint(res.message, {
					type : 'string'
					});
					justep.Shell.closePage();
					//console.log("kkkk"+res.state+res.message);
					console.log(res.message);
				},
				error : function(res) {
				console.log("错误信息"+res.message);
					justep.Util.hint("手机号保存失败,服务异常！", {
					type : 'danger'
					});
					console.log(res.message);
				}
			});
		}
	};

	

	return Model;
});